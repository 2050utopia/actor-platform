//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-model/actor-ios/build/java/im/actor/model/modules/messages/DialogsHistoryActor.java
//

#include "J2ObjC_source.h"
#include "im/actor/model/Configuration.h"
#include "im/actor/model/Messenger.h"
#include "im/actor/model/api/rpc/RequestLoadDialogs.h"
#include "im/actor/model/api/rpc/ResponseLoadDialogs.h"
#include "im/actor/model/droidkit/actors/Actor.h"
#include "im/actor/model/droidkit/actors/ActorRef.h"
#include "im/actor/model/modules/Updates.h"
#include "im/actor/model/modules/messages/DialogsHistoryActor.h"
#include "im/actor/model/modules/updates/internal/DialogHistoryLoaded.h"
#include "im/actor/model/modules/utils/ModuleActor.h"
#include "im/actor/model/network/RpcException.h"
#include "im/actor/model/storage/PreferencesStorage.h"

__attribute__((unused)) static void ImActorModelModulesMessagesDialogsHistoryActor_onLoadMore(ImActorModelModulesMessagesDialogsHistoryActor *self);
__attribute__((unused)) static void ImActorModelModulesMessagesDialogsHistoryActor_onLoadedMoreWithBoolean_withLong_(ImActorModelModulesMessagesDialogsHistoryActor *self, jboolean isFinished, jlong maxLoadedDate);

@interface ImActorModelModulesMessagesDialogsHistoryActor () {
 @public
  AMMessenger *messenger_DialogsHistoryActor_;
  id<ImActorModelStoragePreferencesStorage> preferencesStorage_;
  jlong historyMaxDate_;
  jboolean historyLoaded_;
  jboolean isLoading_;
}

- (void)onLoadMore;

- (void)onLoadedMoreWithBoolean:(jboolean)isFinished
                       withLong:(jlong)maxLoadedDate;
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesDialogsHistoryActor, messenger_DialogsHistoryActor_, AMMessenger *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesDialogsHistoryActor, preferencesStorage_, id<ImActorModelStoragePreferencesStorage>)

@interface ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore () {
 @public
  jboolean isFinished_;
  jlong maxLoadedDate_;
}
@end

@interface ImActorModelModulesMessagesDialogsHistoryActor_$1 () {
 @public
  ImActorModelModulesMessagesDialogsHistoryActor *this$0_;
}
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesDialogsHistoryActor_$1, this$0_, ImActorModelModulesMessagesDialogsHistoryActor *)

@implementation ImActorModelModulesMessagesDialogsHistoryActor

- (instancetype)initWithAMMessenger:(AMMessenger *)messenger {
  if (self = [super initWithAMMessenger:messenger]) {
    isLoading_ = NO;
    self->messenger_DialogsHistoryActor_ = messenger;
  }
  return self;
}

- (void)preStart {
  preferencesStorage_ = [((AMConfiguration *) nil_chk([((AMMessenger *) nil_chk(messenger_DialogsHistoryActor_)) getConfiguration])) getPreferencesStorage];
  historyMaxDate_ = [((id<ImActorModelStoragePreferencesStorage>) nil_chk(preferencesStorage_)) getLongWithNSString:@"dialogs_history_date" withLong:0];
  historyLoaded_ = [preferencesStorage_ getBoolWithNSString:@"dialogs_history_loaded" withBoolean:NO];
  [((ImActorModelDroidkitActorsActorRef *) nil_chk([self self__])) sendOnceWithId:[[ImActorModelModulesMessagesDialogsHistoryActor_LoadMore alloc] init]];
}

- (void)onLoadMore {
  ImActorModelModulesMessagesDialogsHistoryActor_onLoadMore(self);
}

- (void)onLoadedMoreWithBoolean:(jboolean)isFinished
                       withLong:(jlong)maxLoadedDate {
  ImActorModelModulesMessagesDialogsHistoryActor_onLoadedMoreWithBoolean_withLong_(self, isFinished, maxLoadedDate);
}

- (void)onReceiveWithId:(id)message {
  if ([message isKindOfClass:[ImActorModelModulesMessagesDialogsHistoryActor_LoadMore class]]) {
    ImActorModelModulesMessagesDialogsHistoryActor_onLoadMore(self);
  }
  else if ([message isKindOfClass:[ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore class]]) {
    ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore *loaded = (ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore *) check_class_cast(message, [ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore class]);
    ImActorModelModulesMessagesDialogsHistoryActor_onLoadedMoreWithBoolean_withLong_(self, ((ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore *) nil_chk(loaded))->isFinished_, loaded->maxLoadedDate_);
  }
  else {
    [self dropWithId:message];
  }
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesDialogsHistoryActor *)other {
  [super copyAllFieldsTo:other];
  other->messenger_DialogsHistoryActor_ = messenger_DialogsHistoryActor_;
  other->preferencesStorage_ = preferencesStorage_;
  other->historyMaxDate_ = historyMaxDate_;
  other->historyLoaded_ = historyLoaded_;
  other->isLoading_ = isLoading_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithAMMessenger:", "DialogsHistoryActor", NULL, 0x1, NULL },
    { "preStart", NULL, "V", 0x1, NULL },
    { "onLoadMore", NULL, "V", 0x2, NULL },
    { "onLoadedMoreWithBoolean:withLong:", "onLoadedMore", "V", 0x2, NULL },
    { "onReceiveWithId:", "onReceive", "V", 0x1, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "LIMIT_", NULL, 0x1a, "I", NULL, .constantValue.asInt = ImActorModelModulesMessagesDialogsHistoryActor_LIMIT },
    { "messenger_DialogsHistoryActor_", "messenger", 0x2, "Lim.actor.model.Messenger;", NULL,  },
    { "preferencesStorage_", NULL, 0x2, "Lim.actor.model.storage.PreferencesStorage;", NULL,  },
    { "historyMaxDate_", NULL, 0x2, "J", NULL,  },
    { "historyLoaded_", NULL, 0x2, "Z", NULL,  },
    { "isLoading_", NULL, 0x2, "Z", NULL,  },
  };
  static const J2ObjcClassInfo _ImActorModelModulesMessagesDialogsHistoryActor = { 1, "DialogsHistoryActor", "im.actor.model.modules.messages", NULL, 0x1, 5, methods, 6, fields, 0, NULL};
  return &_ImActorModelModulesMessagesDialogsHistoryActor;
}

@end

void ImActorModelModulesMessagesDialogsHistoryActor_onLoadMore(ImActorModelModulesMessagesDialogsHistoryActor *self) {
  if (self->historyLoaded_) {
    return;
  }
  if (self->isLoading_) {
    return;
  }
  self->isLoading_ = YES;
  [self requestWithImActorModelNetworkParserRequest:[[ImActorModelApiRpcRequestLoadDialogs alloc] initWithLong:self->historyMaxDate_ withInt:ImActorModelModulesMessagesDialogsHistoryActor_LIMIT] withAMRpcCallback:[[ImActorModelModulesMessagesDialogsHistoryActor_$1 alloc] initWithImActorModelModulesMessagesDialogsHistoryActor:self]];
}

void ImActorModelModulesMessagesDialogsHistoryActor_onLoadedMoreWithBoolean_withLong_(ImActorModelModulesMessagesDialogsHistoryActor *self, jboolean isFinished, jlong maxLoadedDate) {
  self->isLoading_ = NO;
  if (isFinished) {
    self->historyLoaded_ = YES;
  }
  else {
    self->historyLoaded_ = NO;
    self->historyMaxDate_ = maxLoadedDate;
  }
  [((id<ImActorModelStoragePreferencesStorage>) nil_chk(self->preferencesStorage_)) putBoolWithNSString:@"dialogs_history_loaded" withBoolean:self->historyLoaded_];
  [self->preferencesStorage_ putLongWithNSString:@"dialogs_history_date" withLong:0];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesDialogsHistoryActor)

@implementation ImActorModelModulesMessagesDialogsHistoryActor_LoadMore

- (instancetype)init {
  return [super init];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", NULL, NULL, 0x1, NULL },
  };
  static const J2ObjcClassInfo _ImActorModelModulesMessagesDialogsHistoryActor_LoadMore = { 1, "LoadMore", "im.actor.model.modules.messages", "DialogsHistoryActor", 0x9, 1, methods, 0, NULL, 0, NULL};
  return &_ImActorModelModulesMessagesDialogsHistoryActor_LoadMore;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesDialogsHistoryActor_LoadMore)

@implementation ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore

- (instancetype)initWithBoolean:(jboolean)isFinished
                       withLong:(jlong)maxLoadedDate {
  if (self = [super init]) {
    self->isFinished_ = isFinished;
    self->maxLoadedDate_ = maxLoadedDate;
  }
  return self;
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore *)other {
  [super copyAllFieldsTo:other];
  other->isFinished_ = isFinished_;
  other->maxLoadedDate_ = maxLoadedDate_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithBoolean:withLong:", "LoadedMore", NULL, 0x1, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "isFinished_", NULL, 0x2, "Z", NULL,  },
    { "maxLoadedDate_", NULL, 0x2, "J", NULL,  },
  };
  static const J2ObjcClassInfo _ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore = { 1, "LoadedMore", "im.actor.model.modules.messages", "DialogsHistoryActor", 0x9, 1, methods, 2, fields, 0, NULL};
  return &_ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesDialogsHistoryActor_LoadedMore)

@implementation ImActorModelModulesMessagesDialogsHistoryActor_$1

- (void)onResultWithImActorModelNetworkParserResponse:(ImActorModelApiRpcResponseLoadDialogs *)response {
  [((ImActorModelModulesUpdates *) nil_chk([((AMMessenger *) nil_chk(this$0_->messenger_DialogsHistoryActor_)) getUpdatesModule])) onUpdateReceivedWithId:[[ImActorModelModulesUpdatesInternalDialogHistoryLoaded alloc] initWithImActorModelApiRpcResponseLoadDialogs:response]];
}

- (void)onErrorWithAMRpcException:(AMRpcException *)e {
  [((AMRpcException *) nil_chk(e)) printStackTrace];
}

- (instancetype)initWithImActorModelModulesMessagesDialogsHistoryActor:(ImActorModelModulesMessagesDialogsHistoryActor *)outer$ {
  this$0_ = outer$;
  return [super init];
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesDialogsHistoryActor_$1 *)other {
  [super copyAllFieldsTo:other];
  other->this$0_ = this$0_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "onResultWithImActorModelApiRpcResponseLoadDialogs:", "onResult", "V", 0x1, NULL },
    { "onErrorWithAMRpcException:", "onError", "V", 0x1, NULL },
    { "initWithImActorModelModulesMessagesDialogsHistoryActor:", "init", NULL, 0x0, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lim.actor.model.modules.messages.DialogsHistoryActor;", NULL,  },
  };
  static const J2ObjcClassInfo _ImActorModelModulesMessagesDialogsHistoryActor_$1 = { 1, "$1", "im.actor.model.modules.messages", "DialogsHistoryActor", 0x8000, 3, methods, 1, fields, 0, NULL};
  return &_ImActorModelModulesMessagesDialogsHistoryActor_$1;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesDialogsHistoryActor_$1)
